# @file
# Contains migration configuration for the TowerHealth provider languages.
---
id: towerhealth_providers_specialties_ref
label: Import tower health provider specialties referencees
migration_group: towerhealth_provider_details_group
dependencies:
  enforced:
    module:
      - towerhealth_msow_migration

source:
  plugin: 'provider_specialties_refs'
  # Full path to the file.
  path: 'public://directory/Find_Provider_Dir_Practitioner_Specialties.txt'
  track_changes: true

destination:
  plugin: 'entity:node'

process:
  nid:
    -
      plugin: migration_lookup
      migration: towerhealth_providers
      no_stub: true
      source: practioner_id
    -
      plugin: skip_on_empty
      method: row
    -
      plugin: entity_load_field
      entity_type: node
      field_name: nid
    -
      plugin: extract
      index:
        - 0
        - value

  title:
    -
      plugin: get
      source: '@nid'
    -
      plugin: entity_load_field
      entity_type: node
      field_name: title
    -
      plugin: extract
      index:
        - 0
        - value

  _medical_specialty:
    - plugin: towerhealth_lookup_taxonomy_term
      lookup_field: name
      source: specialty_terms
      vid: medical_specialty
    - plugin: skip_on_empty
      method: row

  field_medical_specialties_ref:
  - plugin: towerhealth_entity_ref_values
    source: '@_medical_specialty'

  field_profile_board_certified: board_certified
