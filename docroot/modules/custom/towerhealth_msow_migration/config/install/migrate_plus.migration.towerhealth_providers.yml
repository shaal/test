id: towerhealth_providers
label: Import tower health provider content
migration_group: towerhealth_provider_base_group
dependencies:
  enforced:
    module:
      - towerhealth_msow_migration

source:
  plugin: 'doctors'
  # Full path to the file.
  path: 'public://directory/Find_Provider_Dir_Practitioner.txt'
  track_changes: true

process:
  field_profile_practid: practioner_id

  field_profile_first_name:
   - plugin: get
     source: first_name
   - plugin: towerhealth_utf_8

  field_profile_last_name:
  - plugin: get
    source: last_name
  - plugin: towerhealth_utf_8

  field_profile_middle_name:
  - plugin: get
    source: middle_name
  - plugin: towerhealth_utf_8

  field_profile_gender:
    - plugin: static_map
      source: gender
      map:
        M: male
        F: female
    - plugin: default_value
      default_value: female

  field_profile_npi: npi_id

  field_profile_professional_title:
  - plugin: get
    source: professional_title
  - plugin: towerhealth_utf_8

  field_profile_employment_type:
    - plugin: static_map
      source:
        - app
        - employment_status
      map:
        'False':
          'Employed': tower_health_employed
          'Contracted': contracted
          '': independent
        'True':
          'Employed': app_employed
          'Contracted': contracted
          '': independent
    - plugin: default_value
      default_value: tower_health_employed

  field_profile_type:
    -
      plugin: static_map
      source:
        - professional_title
      map:
        'CNM': midwife
        'cnm': midwife
        'CRNP': nurse_practitioner
        'crnp': nurse_practitioner
        'DDS': doctor
        'dds': doctor
        'DMD': doctor
        'dmd': doctor
        'DO': doctor
        'do': doctor
        'DPM': doctor
        'dpm': doctor
        'MD': doctor
        'md': doctor
        'PA-C': physician_assistant
        'pa-c': physician_assistant
        'PhD': doctor
        'phd': doctor
        'PsyD': doctor
        'psyd': doctor
    -
      plugin: default_value
      default_value: ''

  field_profile_scheduling:
    - plugin: static_map
      source: open_scheduling
      map:
        'n': false
        'N': false
        '': false
        'Y': true
        'y': true
    - plugin: default_value
      default_value: false

  field_profile_epic_id: epic_id

  type:
    plugin: default_value
    default_value: profile

  moderation_state:
    plugin: default_value
    default_value: published

destination:
  plugin: 'node_merge'
  lookup_field: 'field_profile_practid'
